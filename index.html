<style>
body {
	background:url(sunset_inverted_colour_triangle-wallpaper-1920x1080.jpg) no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}
h1, h2 {
	margin:auto;
	text-align:center;
}
h1 {
color:white;
text-shadow:#000 2px 2px;
font-family:Georgia;
font-size:4em;
}
h2 {
color:#fff;
text-shadow:#666 2px 0 1px;
}
.spacedrum {
background: url('6-notes-evolution-spacedrum-bag.png');
width:300px;
height:300px;
margin:130px auto;
}

img.keyboard {
	position:absolute;
top: 13%;
right: 30%;
opacity:0.7;
}

button {
width: 65px;
height: 65px;
border-radius: 20px;
opacity:0;
cursor: pointer;
}

#Bb3V4 {
position: relative;
top: 38%;
left: 19%;
}

#C4V4 {
position: relative;
bottom: -62%;
left: 18%;
}

#D4V4 {
position: relative;
left: 16%;
top: 64%;
}

#F4V4 {
position: relative;
top: 8%;
right: 26%;
}

#G4V4 {
position: relative;
top: 2%;
left: 71%;
}

#Bb4V4 {
position: relative;
top: 3%;
left: -12%;
}
</style>

<body>
	<h1>spacedrum!</h1>
	<h2>hover the instrument to play or</h2>
	<img class="keyboard" src="keyboard.png"/>
	<div class="spacedrum">
		<button id="C4V4"></button>
		<button id="Bb3V4"></button>
		<button id="D4V4"></button>
		<button id="F4V4"></button>
		<button id="G4V4"></button>
		<button id="Bb4V4"></button>
	</div>
	
</body>

<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
<script type="text/javascript">

SpaceDrum = {
	audioContext: new webkitAudioContext(),
	notes: [],
	sounds: {},
	keyBindings: {
		'87': 'C4V4',
		'65': 'F4V4',
		'83': 'G4V4',
		'68': 'D4V4',
		'90': 'Bb4V4',
		'88': 'Bb3V4',
	},
	load: function() {
		var that = this;
		$.each($('button'), function(key,value){
			that.notes.push( $(value).attr('id') );
		});
		this.loadSounds(this.audioContext);
		$('button').mouseenter(function(){
			SpaceDrum.playSound($(this).attr('id'));
		});
		document.onkeydown = function(e)  {
			kc = e.keyCode;
			if(kc in that.keyBindings) {
				SpaceDrum.playSound( that.keyBindings[kc] );
			}
		}
	},
	loadSound: function (audioContext, key, url) {
	    var request = new XMLHttpRequest(),
	    	dfd = $.Deferred();
	    request.open("get", url);
	    request.responseType = "arraybuffer";
	    request.onload = (function () {
	      this.audioContext.decodeAudioData(request.response, (function (buffer) {
	        this.sounds[key] = buffer;
	        dfd.resolve();
	      }).bind(this));
	    }).bind(this);
	    request.send();
	    return dfd;
	},
	loadSounds: function (audioContext) {
	    var dfds = [],
	    	masterDfd = $.Deferred();
	    for (var key in this.notes) {
	    	var note = this.notes[key];
	        dfds.push(
	       	  this.loadSound(audioContext,
			     note,
			     '6notes'+note+'.mp3'
		      )
		    );
	    }

	    $.when.apply($, dfds).then(function () {
	      masterDfd.resolve();
	    });

	    return masterDfd;
	},
	playSound: function(sound) {
	    var source = this.audioContext.createBufferSource();
	    source.buffer = this.sounds[sound];
	    source.connect(this.audioContext.destination);
	    source.start(0);
	}
};

SpaceDrum.load();
</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-13230251-1']);
  _gaq.push(['_setDomainName', 'diofeher.net']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
